
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.9">
    
    
      
        <title>资源类型 - LRTZ</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto Mono";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#kubernetes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="LRTZ" class="md-header__button md-logo" aria-label="LRTZ" data-md-component="logo">
      
  <img src="../../assets/favicon.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LRTZ
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              资源类型
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/lrtz-v/lrtz-v.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    lrtz-v
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../Develop/git/" class="md-tabs__link">
        Develop
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../basic/" class="md-tabs__link md-tabs__link--active">
        K8S
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../linux/commands/" class="md-tabs__link">
        Linux
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../Redis/redis/" class="md-tabs__link">
        Redis
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LRTZ" class="md-nav__button md-logo" aria-label="LRTZ" data-md-component="logo">
      
  <img src="../../assets/favicon.ico" alt="logo">

    </a>
    LRTZ
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lrtz-v/lrtz-v.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    lrtz-v
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          Develop
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Develop" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Develop
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Develop/git/" class="md-nav__link">
        Git操作
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          K8S
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="K8S" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          K8S
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../basic/" class="md-nav__link">
        基础
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          资源类型
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        资源类型
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    第一个自定义服务
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pod" class="md-nav__link">
    Pod
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replicaset" class="md-nav__link">
    ReplicaSet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployments" class="md-nav__link">
    Deployments
  </a>
  
    <nav class="md-nav" aria-label="Deployments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deplyment" class="md-nav__link">
    更新 Deplyment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    回滚 Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment_1" class="md-nav__link">
    缩放 Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment_2" class="md-nav__link">
    暂停、恢复 Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment_3" class="md-nav__link">
    Deployment 状态
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    清理策略
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment_4" class="md-nav__link">
    Deployment 规约
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#statefulsets" class="md-nav__link">
    StatefulSets
  </a>
  
    <nav class="md-nav" aria-label="StatefulSets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    限制
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    示例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod_1" class="md-nav__link">
    Pod 选择算符
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod_2" class="md-nav__link">
    Pod 标识
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    部署和扩缩保证
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    更新策略
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#daemonset" class="md-nav__link">
    DaemonSet
  </a>
  
    <nav class="md-nav" aria-label="DaemonSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    典型用法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#daemonset-spec" class="md-nav__link">
    编写 DaemonSet Spec
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#daemon-pods" class="md-nav__link">
    Daemon Pods 调度
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#daemon-pods_1" class="md-nav__link">
    与 Daemon Pods 通信
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#daemonset_1" class="md-nav__link">
    更新 DaemonSet
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job" class="md-nav__link">
    Job
  </a>
  
    <nav class="md-nav" aria-label="Job">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#job_1" class="md-nav__link">
    Job 示例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#job_2" class="md-nav__link">
    编写 Job 规约
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod_3" class="md-nav__link">
    处理 Pod 和容器失效
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#job_3" class="md-nav__link">
    Job 终止与清理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#job_4" class="md-nav__link">
    自动清理完成的 Job
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cronjob" class="md-nav__link">
    CronJob
  </a>
  
    <nav class="md-nav" aria-label="CronJob">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cronjob_1" class="md-nav__link">
    CronJob 示例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cronjob_2" class="md-nav__link">
    CronJob 限制
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cronjonv2" class="md-nav__link">
    CronJonV2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    资源回收
  </a>
  
    <nav class="md-nav" aria-label="资源回收">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    宿主与附属
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    控制垃圾收集器删除附属
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../services/" class="md-nav__link">
        网络及服务
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Linux" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/commands/" class="md-nav__link">
        常用命令
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/centos_kernal_upgrade/" class="md-nav__link">
        Centos内核升级
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/cpu/" class="md-nav__link">
        Cpu分析
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5">
          Redis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Redis" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Redis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Redis/redis/" class="md-nav__link">
        简介
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Redis/HashTable/" class="md-nav__link">
        HashTable
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    第一个自定义服务
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pod" class="md-nav__link">
    Pod
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replicaset" class="md-nav__link">
    ReplicaSet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployments" class="md-nav__link">
    Deployments
  </a>
  
    <nav class="md-nav" aria-label="Deployments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deplyment" class="md-nav__link">
    更新 Deplyment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    回滚 Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment_1" class="md-nav__link">
    缩放 Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment_2" class="md-nav__link">
    暂停、恢复 Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment_3" class="md-nav__link">
    Deployment 状态
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    清理策略
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment_4" class="md-nav__link">
    Deployment 规约
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#statefulsets" class="md-nav__link">
    StatefulSets
  </a>
  
    <nav class="md-nav" aria-label="StatefulSets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    限制
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    示例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod_1" class="md-nav__link">
    Pod 选择算符
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod_2" class="md-nav__link">
    Pod 标识
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    部署和扩缩保证
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    更新策略
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#daemonset" class="md-nav__link">
    DaemonSet
  </a>
  
    <nav class="md-nav" aria-label="DaemonSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    典型用法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#daemonset-spec" class="md-nav__link">
    编写 DaemonSet Spec
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#daemon-pods" class="md-nav__link">
    Daemon Pods 调度
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#daemon-pods_1" class="md-nav__link">
    与 Daemon Pods 通信
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#daemonset_1" class="md-nav__link">
    更新 DaemonSet
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job" class="md-nav__link">
    Job
  </a>
  
    <nav class="md-nav" aria-label="Job">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#job_1" class="md-nav__link">
    Job 示例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#job_2" class="md-nav__link">
    编写 Job 规约
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod_3" class="md-nav__link">
    处理 Pod 和容器失效
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#job_3" class="md-nav__link">
    Job 终止与清理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#job_4" class="md-nav__link">
    自动清理完成的 Job
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cronjob" class="md-nav__link">
    CronJob
  </a>
  
    <nav class="md-nav" aria-label="CronJob">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cronjob_1" class="md-nav__link">
    CronJob 示例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cronjob_2" class="md-nav__link">
    CronJob 限制
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cronjonv2" class="md-nav__link">
    CronJonV2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    资源回收
  </a>
  
    <nav class="md-nav" aria-label="资源回收">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    宿主与附属
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    控制垃圾收集器删除附属
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              

                
  <a href="https://github.com/lrtz-v/lrtz-v.github.io/edit/master/docs/K8S/resources.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


  

  <nav class="md-tags" >
    
      
        <a href="../../tags/#k8s" class="md-tag">
          K8S
        </a>
      
    
  </nav>



<h1 id="kubernetes">Kubernetes 工作资源</h1>
<h2 id="_1">第一个自定义服务</h2>
<ul>
<li>为了学习 Kubernetes 工作资源使用姿势，我们自己定义一个 Http 服务，代码如下</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w"></span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;fmt&quot;</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;net/http&quot;</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>

<span class="kd">func</span><span class="w"> </span><span class="nx">indexHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&lt;h1&gt;Test Homepage&lt;/h1&gt;&quot;</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">indexHandler</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8080&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<ul>
<li>Dockerfile 如下</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">golang:latest</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">build</span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>

<span class="k">ENV</span><span class="w"> </span><span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span>
<span class="k">ENV</span><span class="w"> </span><span class="nv">GOPROXY</span><span class="o">=</span>https://mirrors.aliyun.com/goproxy/,direct
<span class="k">ENV</span><span class="w"> </span><span class="nv">GO111MODULE</span><span class="o">=</span>on
<span class="k">ENV</span><span class="w"> </span><span class="nv">GOOS</span><span class="o">=</span>linux

<span class="k">COPY</span><span class="w"> </span>. .
<span class="k">RUN</span><span class="w"> </span>go mod tidy
<span class="k">RUN</span><span class="w"> </span>go build -o app .


<span class="k">FROM</span><span class="w"> </span><span class="s">alpine:latest</span>
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/root/</span>
<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>build /app .
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;./app&quot;</span><span class="p">]</span>
</code></pre></div>
<ul>
<li><a href="https://github.com/lrtz-v/Tutorial/tree/master/k8s/app">完整代码地址</a></li>
</ul>
<h2 id="pod">Pod</h2>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span><span class="w"></span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># hostAliases:</span><span class="w"></span>
<span class="w">  </span><span class="c1">#   - ip: &quot;10.1.2.3&quot;</span><span class="w"></span>
<span class="w">  </span><span class="c1">#     hostnames:</span><span class="w"></span>
<span class="w">  </span><span class="c1">#       - &quot;foo.remote&quot;</span><span class="w"></span>
<span class="w">  </span><span class="c1">#       - &quot;bar.remote&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">shareProcessNamespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span><span class="w"></span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app:1.0.0</span><span class="w"></span>
<span class="w">      </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Never</span><span class="w"></span>
<span class="w">      </span><span class="nt">lifecycle</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">postStart</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">exec</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;/bin/sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;echo</span><span class="nv"> </span><span class="s">Hello</span><span class="nv"> </span><span class="s">Test</span><span class="nv"> </span><span class="s">Start&gt;</span><span class="nv"> </span><span class="s">/tmp/mylog&quot;</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">        </span><span class="nt">preStop</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">exec</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;/bin/sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;echo</span><span class="nv"> </span><span class="s">Hello</span><span class="nv"> </span><span class="s">Test</span><span class="nv"> </span><span class="s">End&gt;</span><span class="nv"> </span><span class="s">/tmp/app/mylog&quot;</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">      </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/app</span><span class="w"></span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-volume</span><span class="w"></span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span><span class="w"></span>
<span class="w">          </span><span class="nt">hostPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span><span class="w"></span>
<span class="w">      </span><span class="nt">livenessProbe</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">exec</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/app/healthy</span><span class="w"></span>
<span class="w">        </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class="w"></span>
<span class="w">        </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class="w"></span>
<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-volume</span><span class="w"></span>
<span class="w">      </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span><span class="w"></span>
</code></pre></div>
<h2 id="replicaset">ReplicaSet</h2>
<ul>
<li>RepicaSet 是通过一组字段来定义的，包括一个用来识别可获得的 Pod 的集合的选择算符、一个用来标明应该维护的副本个数的数值、一个用来指定应该创建新 Pod 以满足副本个数条件时要使用的 Pod 模板等等。 每个 ReplicaSet 都通过根据需要创建和 删除 Pod 以使得副本个数达到期望值， 进而实现其存在价值。当 ReplicaSet 需要创建新的 Pod 时，会使用所提供的 Pod 模板。</li>
<li>ReplicaSet 通过 Pod 上的 metadata.ownerReferences 字段连接到附属 Pod，该字段给出当前对象的属主资源。 ReplicaSet 所获得的 Pod 都在其 ownerReferences 字段中包含了属主 ReplicaSet 的标识信息。正是通过这一连接，ReplicaSet 知道它所维护的 Pod 集合的状态， 并据此计划其操作行为</li>
<li>ReplicaSet 使用其选择算符来辨识要获得的 Pod 集合</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReplicaSet</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-rs</span><span class="w"></span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-rs</span><span class="w"></span>
<span class="w">    </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-rs</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># modify replicas according to your case</span><span class="w"></span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"></span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-rs</span><span class="w"></span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-rs</span><span class="w"></span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span><span class="w"></span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app:1.0.0</span><span class="w"></span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Never</span><span class="w"></span>
</code></pre></div>
<ul>
<li>ReplicaSet 可以被 HPA 自动缩放</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">autoscaling/v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HorizontalPodAutoscaler</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend-scaler</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">scaleTargetRef</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReplicaSet</span><span class="w"></span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span><span class="w"></span>
<span class="w">  </span><span class="nt">minReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"></span>
<span class="w">  </span><span class="nt">maxReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w"></span>
<span class="w">  </span><span class="nt">targetCPUUtilizationPercentage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span><span class="w"></span>
</code></pre></div>
<h2 id="deployments">Deployments</h2>
<ul>
<li>Deployment 控制器为 Pods 和 ReplicaSets 提供声明式的更新能力</li>
<li>Deployment 控制器每次注意到新的 Deployment 时，都会创建一个 ReplicaSet 以启动所需的 Pods</li>
<li>如果更新了 Deployment，则控制标签匹配 .spec.selector 但模板不匹配 .spec.template 的 Pods 的现有 ReplicaSet 被缩容。最终，新的 ReplicaSet 缩放为 .spec.replicas 个副本， 所有旧 ReplicaSets 缩放为 0 个副本</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-deployment</span><span class="w"></span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"></span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span><span class="w"></span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span><span class="w"></span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span><span class="w"></span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app:1.0.0</span><span class="w"></span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span><span class="w"></span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>➜  ~: k get deployment
NAME             READY   UP-TO-DATE   AVAILABLE   AGE
app-deployment   <span class="m">3</span>/3     <span class="m">3</span>            <span class="m">3</span>           7s

➜  ~: k get ReplicaSet
NAME                        DESIRED   CURRENT   READY   AGE
app-deployment-77d4987499   <span class="m">3</span>         <span class="m">3</span>         <span class="m">3</span>       10s

➜  ~: k get pod
NAME                              READY   STATUS    RESTARTS   AGE
app-deployment-77d4987499-5jkj2   <span class="m">1</span>/1     Running   <span class="m">0</span>          23s
app-deployment-77d4987499-g7wcn   <span class="m">1</span>/1     Running   <span class="m">0</span>          23s
app-deployment-77d4987499-h2qsm   <span class="m">1</span>/1     Running   <span class="m">0</span>          23s
</code></pre></div>
<h3 id="deplyment">更新 Deplyment</h3>
<ul>
<li>
<p>更新镜像</p>
</li>
<li>
<p>方式 1</p>
<div class="highlight"><pre><span></span><code>kubectl --record deployment.v1.apps/app-deployment <span class="nb">set</span> image deployment.v1.apps/app-deployment <span class="nv">app</span><span class="o">=</span>app:1.0.1
</code></pre></div>
</li>
<li>
<p>方式 2</p>
<div class="highlight"><pre><span></span><code>kubectl <span class="nb">set</span> image deployment/app-deployment <span class="nv">app</span><span class="o">=</span>app:1.0.2 --record
</code></pre></div>
</li>
<li>
<p>方式 3</p>
<div class="highlight"><pre><span></span><code>kubectl edit deployment.v1.apps/app-deployment
</code></pre></div>
</li>
<li>
<p>deployment 事件记录如下</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>NewReplicaSet:   app-deployment-76fb7489cd <span class="o">(</span><span class="m">3</span>/3 replicas created<span class="o">)</span>
Events:
  Type    Reason             Age                 From                   Message
  ----    ------             ----                ----                   -------
  Normal  ScalingReplicaSet  17m                 deployment-controller  Scaled up replica <span class="nb">set</span> app-deployment-77d4987499 to <span class="m">3</span>
  Normal  ScalingReplicaSet  4m30s               deployment-controller  Scaled up replica <span class="nb">set</span> app-deployment-64fcd57fb to <span class="m">1</span>
  Normal  ScalingReplicaSet  4m28s               deployment-controller  Scaled down replica <span class="nb">set</span> app-deployment-77d4987499 to <span class="m">2</span>
  Normal  ScalingReplicaSet  4m28s               deployment-controller  Scaled up replica <span class="nb">set</span> app-deployment-64fcd57fb to <span class="m">2</span>
  Normal  ScalingReplicaSet  4m27s               deployment-controller  Scaled down replica <span class="nb">set</span> app-deployment-77d4987499 to <span class="m">1</span>
  Normal  ScalingReplicaSet  4m27s               deployment-controller  Scaled up replica <span class="nb">set</span> app-deployment-64fcd57fb to <span class="m">3</span>
  Normal  ScalingReplicaSet  4m26s               deployment-controller  Scaled down replica <span class="nb">set</span> app-deployment-77d4987499 to <span class="m">0</span>
  Normal  ScalingReplicaSet  107s                deployment-controller  Scaled up replica <span class="nb">set</span> app-deployment-647bb69489 to <span class="m">1</span>
  Normal  ScalingReplicaSet  106s                deployment-controller  Scaled down replica <span class="nb">set</span> app-deployment-64fcd57fb to <span class="m">2</span>
  Normal  ScalingReplicaSet  106s                deployment-controller  Scaled up replica <span class="nb">set</span> app-deployment-647bb69489 to <span class="m">2</span>
</code></pre></div>
<ul>
<li>当第一次创建 Deployment 时，它创建了一个 ReplicaSet 并将其直接扩容至 3 个副本</li>
<li>更新 Deployment 时，它创建了一个新的 ReplicaSet ，并将其扩容为 1，然后将旧 ReplicaSet 缩容到 2， 以便至少有 2 个 Pod 可用且最多创建 4 个 Pod</li>
<li>然后，它使用相同的滚动更新策略继续对新的 ReplicaSet 扩容并对旧的 ReplicaSet 缩容。 最后，你将有 3 个可用的副本在新的 ReplicaSet 中，旧 ReplicaSet 将缩容到 0</li>
</ul>
<h3 id="deployment">回滚 Deployment</h3>
<ul>
<li>检查上线版本</li>
</ul>
<div class="highlight"><pre><span></span><code>➜  ~: kubectl rollout <span class="nb">history</span> deployment.v1.apps/app-deployment
deployment.apps/app-deployment
REVISION  CHANGE-CAUSE
<span class="m">1</span>         &lt;none&gt;
<span class="m">2</span>         kubectl deployment.v1.apps/app-deployment <span class="nb">set</span> image deployment.v1.apps/app-deployment <span class="nv">app</span><span class="o">=</span>app:1.0.1 --record<span class="o">=</span><span class="nb">true</span>
<span class="m">3</span>         kubectl <span class="nb">set</span> image deployment/app-deployment <span class="nv">app</span><span class="o">=</span>app:1.0.2 --record<span class="o">=</span><span class="nb">true</span>
<span class="m">4</span>         kubectl <span class="nb">set</span> image deployment/app-deployment <span class="nv">app</span><span class="o">=</span>app:1.0.2 --record<span class="o">=</span><span class="nb">true</span>
</code></pre></div>
<ul>
<li>查看修订历史的详细信息</li>
</ul>
<div class="highlight"><pre><span></span><code>➜  ~: kubectl rollout <span class="nb">history</span> deployment.v1.apps/app-deployment --revision<span class="o">=</span><span class="m">2</span>
deployment.apps/app-deployment with revision <span class="c1">#2</span>
Pod Template:
  Labels: <span class="nv">app</span><span class="o">=</span>app
  pod-template-hash<span class="o">=</span>64fcd57fb
  Annotations: kubernetes.io/change-cause:
    kubectl deployment.v1.apps/app-deployment <span class="nb">set</span> image deployment.v1.apps/app-deployment <span class="nv">app</span><span class="o">=</span>app:1.0.1 --record<span class="o">=</span><span class="nb">true</span>
  Containers:
  app:
    Image: app:1.0.1
    Port: <span class="m">8080</span>/TCP
    Host Port: <span class="m">0</span>/TCP
    Environment: &lt;none&gt;
    Mounts: &lt;none&gt;
  Volumes: &lt;none&gt;
</code></pre></div>
<ul>
<li>
<p>回滚到之前的修订版本</p>
</li>
<li>
<p>撤消当前上线并回滚到以前的修订版本</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>➜  ~: kubectl rollout undo deployment.v1.apps/app-deployment
deployment.apps/app-deployment rolled back
</code></pre></div>
<ul>
<li>会滚到指定版本</li>
</ul>
<div class="highlight"><pre><span></span><code>➜  ~: kubectl rollout undo deployment.v1.apps/app-deployment --to-revision<span class="o">=</span><span class="m">2</span>
deployment.apps/app-deployment rolled back
</code></pre></div>
<h3 id="deployment_1">缩放 Deployment</h3>
<ul>
<li>
<p>缩放</p>
</li>
<li>
<p>命令</p>
<div class="highlight"><pre><span></span><code>➜  ~: kubectl scale deployment.v1.apps/app-deployment --replicas<span class="o">=</span><span class="m">3</span>
</code></pre></div>
</li>
<li>
<p>水平自动缩放</p>
<div class="highlight"><pre><span></span><code>➜  ~: kubectl autoscale deployment.v1.apps/app-deployment --min<span class="o">=</span><span class="m">10</span> --max<span class="o">=</span><span class="m">15</span> --cpu-percent<span class="o">=</span><span class="m">80</span>
</code></pre></div>
</li>
<li>
<p>比例缩放</p>
</li>
<li>
<p>RollingUpdate 的 Deployment 支持同时运行应用程序的多个版本。当自动缩放器缩放处于上线进程（仍在进行中或暂停）中的 RollingUpdate Deployment 时， Deployment 控制器会平衡现有的活跃状态的 ReplicaSets（含 Pods 的 ReplicaSets）中的额外副本， 以降低风险。这称为 比例缩放（Proportional Scaling）</p>
</li>
</ul>
<h3 id="deployment_2">暂停、恢复 Deployment</h3>
<ul>
<li>
<p>在触发一个或多个更新之前暂停 Deployment，然后再恢复其执行</p>
</li>
<li>
<p>例如</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>➜  ~: kubectl rollout pause deployment.v1.apps/app-deployment
deployment.apps/app-deployment paused

➜  ~: kubectl <span class="nb">set</span> resources deployment.v1.apps/app-deployment -c<span class="o">=</span>app --limits<span class="o">=</span><span class="nv">cpu</span><span class="o">=</span>200m,memory<span class="o">=</span>512Mi
deployment.apps/app-deployment resource requirements updated

➜  ~: kubectl rollout resume deployment.v1.apps/app-deployment
deployment.apps/nginx-deployment resumed

➜  ~: kubectl get rs -w
deployment.apps/nginx-deployment resumed
</code></pre></div>
<h3 id="deployment_3">Deployment 状态</h3>
<ul>
<li>状态查询</li>
</ul>
<div class="highlight"><pre><span></span><code>➜  ~: kubectl rollout status deployment.v1.apps/nginx-deployment
</code></pre></div>
<ul>
<li>
<p>进行中的 Deployment</p>
</li>
<li>
<p>出现场景</p>
<ul>
<li>Deployment 创建新的 ReplicaSet</li>
<li>Deployment 正在为其最新的 ReplicaSet 扩容</li>
<li>Deployment 正在为其旧有的 ReplicaSet(s) 缩容</li>
<li>新的 Pods 已经就绪或者可用（就绪至少持续了 MinReadySeconds 秒）</li>
</ul>
</li>
<li>
<p>完成的 Deployment</p>
</li>
<li>
<p>出现场景</p>
<ul>
<li>与 Deployment 关联的所有副本都已更新到指定的最新版本，这意味着之前请求的所有更新都已完成</li>
<li>与 Deployment 关联的所有副本都可用</li>
<li>未运行 Deployment 的旧副本</li>
</ul>
</li>
<li>
<p>失败的 Deployment</p>
</li>
<li>
<p>Deployment 可能一直处于未完成状态，出现场景如下</p>
<ul>
<li>配额（Quota）不足</li>
<li>就绪探测（Readiness Probe）失败</li>
<li>镜像拉取错误</li>
<li>权限不足</li>
<li>限制范围（Limit Ranges）问题</li>
<li>应用程序运行时的配置错误</li>
</ul>
</li>
<li>
<p>检测方式</p>
<ul>
<li>在 Deployment 规约中指定截止时间参数：.spec.progressDeadlineSeconds</li>
</ul>
<div class="highlight"><pre><span></span><code>➜  ~: kubectl patch deployment.v1.apps/nginx-deployment -p <span class="s1">&#39;{&quot;spec&quot;:{&quot;progressDeadlineSeconds&quot;:600}}&#39;</span>
</code></pre></div>
<ul>
<li>一旦超过 Deployment 进度限期，Kubernetes 将更新状态和进度状况的原因</li>
</ul>
<div class="highlight"><pre><span></span><code>Conditions:
  Type            Status  Reason
  ----            ------  ------
  Available       True    MinimumReplicasAvailable
  Progressing     False   ProgressDeadlineExceeded
  ReplicaFailure  True    FailedCreate
</code></pre></div>
</li>
</ul>
<h3 id="_2">清理策略</h3>
<ul>
<li>在 Deployment 中设置 .spec.revisionHistoryLimit 字段以指定保留此 Deployment 的多少个旧有 ReplicaSet。其余的 ReplicaSet 将在后台被垃圾回收。 默认情况下，此值为 10</li>
<li>将此字段设置为 0 将导致 Deployment 的所有历史记录被清空，因此 Deployment 将无法回滚</li>
</ul>
<h3 id="deployment_4">Deployment 规约</h3>
<ul>
<li>
<p>apiVersion，kind 和 metadata</p>
</li>
<li>
<p>Pod 模板</p>
</li>
<li>
<p>.spec 中只有 .spec.template 和 .spec.selector 是必需的字段</p>
<ul>
<li>.spec.template 是一个 Pod 模板</li>
</ul>
</li>
<li>
<p>副本</p>
</li>
<li>
<p>.spec.replicas 是指定所需 Pod 的可选字段。它的默认值是 1</p>
</li>
<li>
<p>选择算符</p>
</li>
<li>
<p>.spec.selector 是指定本 Deployment 的 Pod 标签选择算符的必需字段</p>
<ul>
<li>必须匹配 .spec.template.metadata.labels，否则请求会被 API 拒绝</li>
</ul>
</li>
<li>
<p>策略</p>
</li>
<li>
<p>.spec.strategy 策略指定用于用新 Pods 替换旧 Pods 的策略</p>
</li>
<li>
<p>.spec.strategy.type 可以是 “Recreate” 或 “RollingUpdate”(默认)</p>
</li>
<li>
<p>重新创建 Deployment</p>
<ul>
<li>如果 .spec.strategy.type==Recreate，在创建新 Pods 之前，所有现有的 Pods 会被杀死</li>
</ul>
</li>
<li>
<p>滚动更新 Deployment</p>
<ul>
<li>Deployment 会在 .spec.strategy.type==RollingUpdate 时，采取滚动更新的方式更新 Pods，可以指定 maxUnavailable 和 maxSurge 来控制滚动更新过程</li>
<li>maxUnavailable<ul>
<li>.spec.strategy.rollingUpdate.maxUnavailable 是一个可选字段，用来指定 更新过程中不可用的 Pod 的个数上限；该值可以是绝对数字（例如，5），也可以是 所需 Pods 的百分比（例如，10%）。百分比值会转换成绝对数并去除小数部分。 如果 .spec.strategy.rollingUpdate.maxSurge 为 0，则此值不能为 0。 默认值为 25%</li>
</ul>
</li>
<li>maxSurge<ul>
<li>.spec.strategy.rollingUpdate.maxSurge 是一个可选字段，用来指定可以创建的超出 期望 Pod 个数的 Pod 数量。此值可以是绝对数（例如，5）或所需 Pods 的百分比（例如，10%）。 如果 MaxUnavailable 为 0，则此值不能为 0。百分比值会通过向上取整转换为绝对数。 此字段的默认值为 25%</li>
</ul>
</li>
</ul>
</li>
<li>
<p>进度期限秒数</p>
</li>
<li>
<p>.spec.progressDeadlineSeconds 是一个可选字段，用于指定系统在报告 Deployment 进展失败 之前等待 Deployment 取得进展的秒数</p>
</li>
<li>
<p>如果指定，则此字段值需要大于 .spec.minReadySeconds 取值</p>
</li>
<li>
<p>最短就绪时间</p>
</li>
<li>
<p>.spec.minReadySeconds 是一个可选字段，用于指定新创建的 Pod 在没有任意容器崩溃情况下的最小就绪时间， 只有超出这个时间 Pod 才被视为可用。默认值为 0（Pod 在准备就绪后立即将被视为可用）</p>
</li>
<li>
<p>修订历史限制</p>
</li>
<li>
<p>Deployment 的修订历史记录存储在它所控制的 ReplicaSets 中</p>
</li>
<li>.spec.revisionHistoryLimit 是一个可选字段，用来设定出于会滚目的所要保留的旧 ReplicaSet 数量。 这些旧 ReplicaSet 会消耗 etcd 中的资源，并占用 kubectl get rs 的输出</li>
<li>
<p>每个 Deployment 修订版本的配置都存储在其 ReplicaSets 中；因此，一旦删除了旧的 ReplicaSet， 将失去回滚到 Deployment 的对应修订版本的能力。 默认情况下，系统保留 10 个旧 ReplicaSet，但其理想值取决于新 Deployment 的频率和稳定性</p>
</li>
<li>
<p>paused</p>
</li>
<li>.spec.paused 是用于暂停和恢复 Deployment 的可选布尔字段。</li>
<li>暂停的 Deployment 和未暂停的 Deployment 的唯一区别是<ul>
<li>Deployment 处于暂停状态时， PodTemplateSpec 的任何修改都不会触发新的上线。 Deployment 在创建时是默认不会处于暂停状态</li>
</ul>
</li>
</ul>
<h2 id="statefulsets">StatefulSets</h2>
<ul>
<li>StatefulSet 是用来管理有状态应用的工作负载 API 对象；可以用来管理某 Pod 集合的部署和扩缩， 并为这些 Pod 提供持久存储和持久标识符</li>
<li>和 Deployment 类似， StatefulSet 管理基于相同容器规约的一组 Pod</li>
<li>但和 Deployment 不同的是， StatefulSet 为它们的每个 Pod 维护了一个有粘性的 ID，这些 Pod 是基于相同的规约来创建的， 但是不能相互替换：无论怎么调度，每个 Pod 都有一个永久不变的 ID</li>
</ul>
<h3 id="_3">限制</h3>
<ul>
<li>给定 Pod 的存储必须由 PersistentVolume 驱动 基于所请求的 storage class 来提供，或者由管理员预先提供</li>
<li>删除或者收缩 StatefulSet 并不会删除它关联的存储卷。 这样做是为了保证数据安全，它通常比自动清除 StatefulSet 所有相关的资源更有价值</li>
<li>StatefulSet 当前需要 Headless Service 来负责 Pod 的网络标识。你需要负责创建此服务</li>
<li>当删除 StatefulSets 时，StatefulSet 不提供任何终止 Pod 的保证。 为了实现 StatefulSet 中的 Pod 可以有序地且体面地终止，可以在删除之前将 StatefulSet 缩放为 0</li>
<li>在默认 Pod 管理策略(OrderedReady) 时使用 滚动更新，可能进入需要人工干预 才能修复的损坏状态</li>
</ul>
<h3 id="_4">示例</h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span><span class="w"></span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span><span class="w"></span>
<span class="w">  </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span><span class="w"></span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span><span class="w"></span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class="w"></span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span><span class="w"></span>
<span class="nn">---</span><span class="w"></span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StatefulSet</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span><span class="w"></span>
<span class="w">  </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;app&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"></span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span><span class="w"></span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w"></span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span><span class="w"></span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app:1.0.3</span><span class="w"></span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Never</span><span class="w"></span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span><span class="w"></span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span><span class="w"></span>
</code></pre></div>
<h3 id="pod_1">Pod 选择算符</h3>
<ul>
<li>必须设置 StatefulSet 的 .spec.selector 字段，使之匹配其在 .spec.template.metadata.labels 中设置的标签</li>
</ul>
<h3 id="pod_2">Pod 标识</h3>
<ul>
<li>
<p>StatefulSet Pod 具有唯一的标识，该标识包括顺序标识、稳定的网络标识和稳定的存储。 该标识和 Pod 是绑定的，不管它被调度在哪个节点上</p>
</li>
<li>
<p>有序索引</p>
</li>
<li>
<p>对于具有 N 个副本的 StatefulSet，StatefulSet 中的每个 Pod 将被分配一个整数序号， 从 0 到 N-1，该序号在 StatefulSet 上是唯一的</p>
</li>
<li>
<p>稳定的网络 ID</p>
</li>
<li>
<p>StatefulSet 中的每个 Pod 根据 StatefulSet 的名称和 Pod 的序号派生出它的主机名</p>
</li>
<li>组合主机名的格式为<span class="arithmatex">\((StatefulSet 名称)-\)</span>(序号)</li>
<li>
<p>StatefulSet 可以使用 Headless Service 控制它的 Pod 的网络域。管理域的这个服务的格式为： <span class="arithmatex">\((服务名称).\)</span>(命名空间).svc.cluster.local，其中 cluster.local 是集群域。 一旦每个 Pod 创建成功，就会得到一个匹配的 DNS 子域，格式为： <span class="arithmatex">\((pod 名称).\)</span>(所属服务的 DNS 域名)，其中所属服务由 StatefulSet 的 serviceName 域来设定。</p>
</li>
<li>
<p>稳定的存储</p>
</li>
<li>
<p>Kubernetes 为每个 VolumeClaimTemplate 创建一个 PersistentVolume</p>
</li>
<li>
<p>在上面的示例中，每个 Pod 将会得到基于 StorageClass my-storage-class 提供的 1 Gib 的 PersistentVolume。如果没有声明 StorageClass，就会使用默认的 StorageClass。 当一个 Pod 被调度（重新调度）到节点上时，它的 volumeMounts 会挂载与其 PersistentVolumeClaims 相关联的 PersistentVolume。 请注意，当 Pod 或者 StatefulSet 被删除时，与 PersistentVolumeClaims 相关联的 PersistentVolume 并不会被删除。要删除它必须通过手动方式来完成。</p>
</li>
<li>
<p>Pod 名称标签</p>
</li>
<li>当 StatefulSet 控制器（Controller） 创建 Pod 时， 它会添加一个标签 statefulset.kubernetes.io/pod-name，该标签值设置为 Pod 名称。 这个标签允许给 StatefulSet 中的特定 Pod 绑定一个 Service</li>
</ul>
<h3 id="_5">部署和扩缩保证</h3>
<ul>
<li>对于包含 N 个 副本的 StatefulSet，当部署 Pod 时，它们是依次创建的，顺序为 0..N-1</li>
<li>当删除 Pod 时，它们是逆序终止的，顺序为 N-1..0</li>
<li>在将缩放操作应用到 Pod 之前，它前面的所有 Pod 必须是 Running 和 Ready 状态</li>
<li>在 Pod 终止之前，所有的继任者必须完全关闭</li>
</ul>
<h3 id="_6">更新策略</h3>
<ul>
<li>StatefulSet 的 .spec.updateStrategy 字段让 你可以配置和禁用掉自动滚动更新 Pod 的容器、标签、资源请求或限制、以及注解</li>
<li>
<p>当 StatefulSet 的 .spec.updateStrategy.type 设置为 OnDelete 时，它的控制器将不会自动更新 StatefulSet 中的 Pod。 用户必须手动删除 Pod 以便让控制器创建新的 Pod，以此来对 StatefulSet 的 .spec.template 的变动作出反应</p>
</li>
<li>
<p>滚动更新</p>
</li>
<li>
<p>RollingUpdate 更新策略对 StatefulSet 中的 Pod 执行自动的滚动更新。 在没有声明 .spec.updateStrategy 时，RollingUpdate 是默认配置。 当 StatefulSet 的 .spec.updateStrategy.type 被设置为 RollingUpdate 时， StatefulSet 控制器会删除和重建 StatefulSet 中的每个 Pod。 它将按照与 Pod 终止相同的顺序（从最大序号到最小序号）进行，每次更新一个 Pod。 它会等到被更新的 Pod 进入 Running 和 Ready 状态，然后再更新其前身</p>
</li>
<li>
<p>分区</p>
<ul>
<li>通过声明 .spec.updateStrategy.rollingUpdate.partition 的方式，RollingUpdate 更新策略可以实现分区</li>
<li>如果声明了一个分区，当 StatefulSet 的 .spec.template 被更新时， 所有序号大于等于该分区序号的 Pod 都会被更新。 所有序号小于该分区序号的 Pod 都不会被更新，并且，即使他们被删除也会依据之前的版本进行重建</li>
<li>如果 StatefulSet 的 .spec.updateStrategy.rollingUpdate.partition 大于它的 .spec.replicas，对它的 .spec.template 的更新将不会传递到它的 Pod</li>
</ul>
</li>
<li>
<p>强制回滚</p>
<ul>
<li>在默认 Pod 管理策略(OrderedReady) 下使用 滚动更新 ，可能进入需要人工干预才能修复的损坏状态</li>
<li>如果更新后 Pod 模板配置进入无法运行或就绪的状态（例如，由于错误的二进制文件 或应用程序级配置错误），StatefulSet 将停止回滚并等待</li>
<li>在这种状态下，仅将 Pod 模板还原为正确的配置是不够的，StatefulSet 将继续等待损坏状态的 Pod 准备就绪（永远不会发生），然后再尝试将其恢复为正常工作配置</li>
<li>恢复模板后，还必须删除 StatefulSet 尝试使用错误的配置来运行的 Pod。这样， StatefulSet 才会开始使用被还原的模板来重新创建 Pod</li>
</ul>
</li>
</ul>
<h2 id="daemonset">DaemonSet</h2>
<ul>
<li>确保全部（或者某些）节点上运行一个 Pod 的副本。 当有节点加入集群时， 也会为他们新增一个 Pod 。 当有节点从集群移除时，这些 Pod 也会被回收。删除 DaemonSet 将会删除它创建的所有 Pod</li>
</ul>
<h3 id="_7">典型用法</h3>
<ul>
<li>在每个节点上运行集群守护进程</li>
<li>在每个节点上运行日志收集守护进程</li>
<li>在每个节点上运行监控守护进程</li>
</ul>
<h3 id="daemonset-spec">编写 DaemonSet Spec</h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DaemonSet</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluentd-elasticsearch</span><span class="w"></span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span><span class="w"></span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">k8s-app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluentd-logging</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluentd-elasticsearch</span><span class="w"></span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluentd-elasticsearch</span><span class="w"></span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">tolerations</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node-role.kubernetes.io/master</span><span class="w"></span>
<span class="w">          </span><span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NoSchedule</span><span class="w"></span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluentd-elasticsearch</span><span class="w"></span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/fluentd_elasticsearch/fluentd:v2.5.2</span><span class="w"></span>
<span class="w">          </span><span class="nt">resources</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">limits</span><span class="p">:</span><span class="w"></span>
<span class="w">              </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200Mi</span><span class="w"></span>
<span class="w">            </span><span class="nt">requests</span><span class="p">:</span><span class="w"></span>
<span class="w">              </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100m</span><span class="w"></span>
<span class="w">              </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200Mi</span><span class="w"></span>
<span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">varlog</span><span class="w"></span>
<span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">varlibdockercontainers</span><span class="w"></span>
<span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/docker/containers</span><span class="w"></span>
<span class="w">              </span><span class="nt">readOnly</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">      </span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class="w"></span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">varlog</span><span class="w"></span>
<span class="w">          </span><span class="nt">hostPath</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">varlibdockercontainers</span><span class="w"></span>
<span class="w">          </span><span class="nt">hostPath</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/docker/containers</span><span class="w"></span>
</code></pre></div>
<ul>
<li>
<p>Pod 模板</p>
</li>
<li>
<p>在 DaemonSet 中的 Pod 模板必须具有一个值为 Always 的 RestartPolicy。 当该值未指定时，默认是 Always</p>
</li>
<li>
<p>仅在某些节点上运行 Pod</p>
</li>
<li>如果指定了 .spec.template.spec.nodeSelector，DaemonSet 控制器将在能够与 Node 选择算符 匹配的节点上创建 Pod</li>
<li>类似可以指定 .spec.template.spec.affinity，之后 DaemonSet 控制器 将在能够与节点亲和性 匹配的节点上创建 Pod</li>
</ul>
<h3 id="daemon-pods">Daemon Pods 调度</h3>
<ul>
<li>DaemonSet 确保所有符合条件的节点都运行该 Pod 的一个副本</li>
<li>DaemonSet Pods 由 DaemonSet 控制器创建和调度，带来了以下问题</li>
<li>Pod 行为的不一致性：正常 Pod 在被创建后等待调度时处于 Pending 状态， DaemonSet Pods 创建后不会处于 Pending 状态下。这使用户感到困惑</li>
<li>Pod 抢占 由默认调度器处理。启用抢占后，DaemonSet 控制器将在不考虑 Pod 优先级和抢占 的情况下制定调度决策</li>
<li>ScheduleDaemonSetPods 允许您使用默认调度器而不是 DaemonSet 控制器来调度 DaemonSets，方法是将 NodeAffinity 条件而不是 .spec.nodeName 条件添加到 DaemonSet Pods</li>
<li>默认调度器接下来将 Pod 绑定到目标主机</li>
<li>如果 DaemonSet Pod 的节点亲和性配置已存在，则被替换</li>
<li>DaemonSet 控制器仅在创建或修改 DaemonSet Pod 时执行这些操作， 并且不会更改 DaemonSet 的 spec.template</li>
<li>系统会自动添加 node.kubernetes.io/unschedulable：NoSchedule 容忍度到 DaemonSet Pods。在调度 DaemonSet Pod 时，默认调度器会忽略 unschedulable 节点</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">nodeAffinity</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">requiredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">nodeSelectorTerms</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">matchFields</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metadata.name</span><span class="w"></span>
<span class="w">            </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">In</span><span class="w"></span>
<span class="w">            </span><span class="nt">values</span><span class="p">:</span><span class="w"></span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">target-host-name</span><span class="w"></span>
</code></pre></div>
<h3 id="daemon-pods_1">与 Daemon Pods 通信</h3>
<ul>
<li>推送（Push）：配置 DaemonSet 中的 Pod，将更新发送到另一个服务，例如统计数据库。 这些服务没有客户端</li>
<li>NodeIP 和已知端口：DaemonSet 中的 Pod 可以使用 hostPort，从而可以通过节点 IP 访问到 Pod。客户端能通过某种方法获取节点 IP 列表，并且基于此也可以获取到相应的端口</li>
<li>DNS：创建具有相同 Pod 选择算符的 无头服务， 通过使用 endpoints 资源或从 DNS 中检索到多个 A 记录来发现 DaemonSet</li>
<li>Service：创建具有相同 Pod 选择算符的服务，并使用该服务随机访问到某个节点上的 守护进程（没有办法访问到特定节点）</li>
</ul>
<h3 id="daemonset_1">更新 DaemonSet</h3>
<ul>
<li>如果节点的标签被修改，DaemonSet 将立刻向新匹配上的节点添加 Pod， 同时删除不匹配的节点上的 Pod</li>
<li>你可以修改 DaemonSet 创建的 Pod。不过并非 Pod 的所有字段都可更新</li>
<li>可以删除一个 DaemonSet</li>
</ul>
<h2 id="job">Job</h2>
<ul>
<li>Job 会创建一个或者多个 Pods，并确保指定数量的 Pods 成功终止</li>
<li>随着 Pods 成功结束，Job 跟踪记录成功完成的 Pods 个数。 当数量达到指定的成功个数阈值时，任务（即 Job）结束。 删除 Job 的操作会清除所创建的全部 Pods</li>
</ul>
<h3 id="job_1">Job 示例</h3>
<ul>
<li>计算 π 到小数点后 100 位，并将结果打印出来</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">batch/v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Job</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pi</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pi</span><span class="w"></span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resouer/ubuntu-bc</span><span class="w"></span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Never</span><span class="w"></span>
<span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;echo</span><span class="nv"> </span><span class="s">&#39;scale=100;</span><span class="nv"> </span><span class="s">4*a(1)&#39;</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">bc</span><span class="nv"> </span><span class="s">-l</span><span class="nv"> </span><span class="s">&quot;</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Never</span><span class="w"></span>
<span class="w">  </span><span class="nt">backoffLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"></span>
<span class="w">  </span><span class="nt">activeDeadlineSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span><span class="w"></span>
</code></pre></div>
<ul>
<li>kubectl logs $pods</li>
</ul>
<h3 id="job_2">编写 Job 规约</h3>
<ul>
<li>
<p>Job 的并行执行</p>
</li>
<li>
<p>非并行 Job</p>
<ul>
<li>通常只启动一个 Pod，除非该 Pod 失败</li>
<li>当 Pod 成功终止时，立即视 Job 为完成状态</li>
<li>可以不设置 spec.completions 和 spec.parallelism。 这两个属性都不设置时，均取默认值 1</li>
</ul>
</li>
<li>具有 确定完成计数 的并行 Job<ul>
<li>.spec.completions 为所需要的完成个数，若不设置 spec.completions，默认值为 .spec.parallelism，其默认值为 1</li>
<li>Job 用来代表整个任务，当对应于 1 和 .spec.completions 之间的每个整数都存在 一个成功的 Pod 时，Job 被视为完成</li>
<li>尚未实现：每个 Pod 收到一个介于 1 和 spec.completions 之间的不同索引值</li>
</ul>
</li>
<li>
<p>带 工作队列 的并行 Job</p>
<ul>
<li>不可以设置 .spec.completions，但要将.spec.parallelism 设置为一个非负整数</li>
<li>多个 Pod 之间必须相互协调，或者借助外部服务确定每个 Pod 要处理哪个工作条目。 例如，任一 Pod 都可以从工作队列中取走最多 N 个工作条目</li>
<li>每个 Pod 都可以独立确定是否其它 Pod 都已完成，进而确定 Job 是否完成</li>
<li>当 Job 中 任何 Pod 成功终止，不再创建新 Pod</li>
<li>一旦至少 1 个 Pod 成功完成，并且所有 Pod 都已终止，即可宣告 Job 成功完成</li>
<li>一旦任何 Pod 成功退出，任何其它 Pod 都不应再对此任务执行任何操作或生成任何输出。 所有 Pod 都应启动退出过程</li>
</ul>
</li>
<li>
<p>控制并行性</p>
</li>
<li>并行性请求（.spec.parallelism）可以设置为任何非负整数。 如果未设置，则默认为 1。 如果设置为 0，则 Job 相当于启动之后便被暂停，直到此值被增加</li>
<li>实际并行性（在任意时刻运行状态的 Pods 个数）可能比并行性请求略大或略小， 原因如下<ul>
<li>对于 确定完成计数 Job，实际上并行执行的 Pods 个数不会超出剩余的完成数。 如果 .spec.parallelism 值较高，会被忽略。</li>
<li>对于 工作队列 Job，有任何 Job 成功结束之后，不会有新的 Pod 启动。 不过，剩下的 Pods 允许执行完毕。</li>
<li>如果 Job 控制器 没有来得及作出响应，或者</li>
<li>如果 Job 控制器因为任何原因（例如，缺少 ResourceQuota 或者没有权限）无法创建 Pods。 Pods 个数可能比请求的 - 数目小。</li>
<li>Job 控制器可能会因为之前同一 Job 中 Pod 失效次数过多而压制新 Pod 的创建。</li>
<li>当 Pod 处于体面终止进程中，需要一定时间才能停止。</li>
</ul>
</li>
</ul>
<h3 id="pod_3">处理 Pod 和容器失效</h3>
<ul>
<li>
<p>Pod 中的容器可能因为多种不同原因失效</p>
</li>
<li>
<p>.spec.template.spec.restartPolicy = "OnFailure"</p>
<ul>
<li>Pod 则继续留在当前节点，但容器会被重新运行</li>
</ul>
</li>
<li>
<p>.spec.template.spec.restartPolicy = "Never"</p>
<ul>
<li>Job 控制器会启动一个新的 Pod</li>
</ul>
</li>
<li>
<p>即使将 .spec.parallelism 设置为 1，且将 .spec.completions 设置为 1，并且 .spec.template.spec.restartPolicy 设置为 "Never"，同一程序仍然有可能被启动两次</p>
</li>
<li>
<p>Pod 回退失效策略</p>
</li>
<li>在有些情形下，我们可能希望 Job 在经历若干次重试之后直接进入失败状态，因为这很可能意味着遇到了配置错误</li>
<li>可以将 .spec.backoffLimit 设置为视 Job 为失败之前的重试次数，失效回退的限制值默认为 6，一旦重试次数到达 .spec.backoffLimit 所设的上限，Job 会被标记为失败， 其中运行的 Pods 都会被终止</li>
<li>与 Job 相关的失效的 Pod 会被 Job 控制器重建，并且以指数型回退计算重试延迟 （从 10 秒、20 秒到 40 秒，最多 6 分钟）。 当 Job 的 Pod 被删除时，或者 Pod 成功时没有其它 Pod 处于失败状态，失效回退的次数也会被重置（为 0）</li>
</ul>
<h3 id="job_3">Job 终止与清理</h3>
<ul>
<li>
<p>Job 完成时不会再创建新的 Pod，不过已有的 Pod 也不会被删除。 保留这些 Pod 使得你可以查看已完成的 Pod 的日志输出，以便检查错误、警告 或者其它诊断性输出</p>
</li>
<li>
<p>你可以为 Job 的 .spec.activeDeadlineSeconds 设置一个秒数值，值适用于 Job 的整个生命期，无论 Job 创建了多少个 Pod。 一旦 Job 运行时间达到 activeDeadlineSeconds 秒，其所有运行中的 Pod 都会被终止，并且 Job 的状态更新为 type: Failed 及 reason: DeadlineExceeded</p>
</li>
<li>Job 的 .spec.activeDeadlineSeconds 优先级高于其 .spec.backoffLimit 设置</li>
</ul>
<h3 id="job_4">自动清理完成的 Job</h3>
<ul>
<li>
<p>如果 Job 由某种更高级别的控制器来管理，例如 CronJobs， 则 Job 可以被 CronJob 基于特定的根据容量裁定的清理策略清理掉</p>
</li>
<li>
<p>使用由 TTL 控制器所提供 的 TTL 机制自动清理 Job</p>
</li>
<li>
<p>设置 Job 的 .spec.ttlSecondsAfterFinished 字段，可以让该控制器清理掉 已结束的资源</p>
</li>
<li>如果该字段设置为 0，Job 在结束之后立即成为可被自动删除的对象</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">batch/v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Job</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pi</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pi</span><span class="w"></span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resouer/ubuntu-bc</span><span class="w"></span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Never</span><span class="w"></span>
<span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;echo</span><span class="nv"> </span><span class="s">&#39;scale=100;</span><span class="nv"> </span><span class="s">4*a(1)&#39;</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">bc</span><span class="nv"> </span><span class="s">-l</span><span class="nv"> </span><span class="s">&quot;</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Never</span><span class="w"></span>
<span class="w">  </span><span class="nt">backoffLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"></span>
<span class="w">  </span><span class="nt">activeDeadlineSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span><span class="w"></span>
<span class="w">  </span><span class="nt">ttlSecondsAfterFinished</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span><span class="w"></span>
</code></pre></div>
<h2 id="cronjob">CronJob</h2>
<ul>
<li>Cron Job 创建基于时间调度的 Jobs，对于创建周期性的、反复重复的任务很有用，例如执行数据备份或者发送邮件。 CronJobs 也可以用来计划在指定时间来执行的独立任务，例如计划当集群看起来很空闲时 执行某个 Job</li>
</ul>
<h3 id="cronjob_1">CronJob 示例</h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">batch/v1beta1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CronJob</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hello</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">schedule</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;*/1</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">jobTemplate</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">template</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">containers</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hello</span><span class="w"></span>
<span class="w">              </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">busybox</span><span class="w"></span>
<span class="w">              </span><span class="nt">args</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bin/sh</span><span class="w"></span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-c</span><span class="w"></span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">date; echo Hello from the Kubernetes cluster</span><span class="w"></span>
<span class="w">          </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OnFailure</span><span class="w"></span>
</code></pre></div>
<h3 id="cronjob_2">CronJob 限制</h3>
<ul>
<li>CronJob 根据其计划编排，在每次该执行任务的时候大约会创建一个 Job</li>
<li>在某些情况下，可能会创建两个 Job，或者不会创建任何 Job</li>
<li>如果 startingDeadlineSeconds 设置为很大的数值或未设置（默认），并且 concurrencyPolicy 设置为 Allow，则作业将始终至少运行一次；如果 startingDeadlineSeconds 是 200，则控制器会统计在过去 200 秒中错过了多少次 Job</li>
<li>CronJob 控制器（Controller） 检查从上一次调度的时间点到现在所错过了调度次数。如果错过的调度次数超过 100 次， 那么它就不会启动这个任务，并记录这个错误</li>
<li>未能在调度时间内创建 CronJob，则计为错过</li>
</ul>
<h3 id="cronjonv2">CronJonV2</h3>
<ul>
<li>--feature-gates="CronJobControllerV2=true"</li>
</ul>
<h2 id="_8">资源回收</h2>
<h3 id="_9">宿主与附属</h3>
<ul>
<li>每个附属对象具有一个指向其所属对象的 metadata.ownerReferences 字段</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReplicaSet</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-repset</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"></span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">pod-is-for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">garbage-collection-example</span><span class="w"></span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">pod-is-for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">garbage-collection-example</span><span class="w"></span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span><span class="w"></span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app:1.0.0</span><span class="w"></span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Never</span><span class="w"></span>
</code></pre></div>
<ul>
<li>
<p>通过 kubectl get pods --output=yaml 查看 ownerReferences</p>
</li>
<li>
<p>显示了 Pod 的属主是名为 my-repset 的 ReplicaSet</p>
<div class="highlight"><pre><span></span><code><span class="nt">ownerReferences</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span><span class="w"></span>
<span class="w">    </span><span class="nt">blockOwnerDeletion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReplicaSet</span><span class="w"></span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-repset</span><span class="w"></span>
<span class="w">    </span><span class="nt">uid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">00c1a24c-1418-4c3b-be9d-326915144427</span><span class="w"></span>
</code></pre></div>
</li>
</ul>
<h3 id="_10">控制垃圾收集器删除附属</h3>
<ul>
<li>
<p>当你删除对象时，可以指定该对象的附属是否也自动删除</p>
</li>
<li>
<p>不自动删除它的附属，这些附属被称作 孤立对象（Orphaned）</p>
</li>
<li>
<p>自动删除附属的行为也称为 级联删除（Cascading Deletion）</p>
<ul>
<li>级联删除模式</li>
<li>后台（Background） 模式</li>
<li>前台（Foreground） 模式</li>
</ul>
</li>
<li>
<p>前台级联删除</p>
</li>
<li>根对象首先进入 deletion in progress 状态。 在 deletion in progress 状态，会有如下的情况<ul>
<li>对象仍然可以通过 REST API 可见</li>
<li>对象的 deletionTimestamp 字段被设置</li>
<li>对象的 metadata.finalizers 字段包含值 foregroundDeletion</li>
</ul>
</li>
<li>一旦对象被设置为 deletion in progress 状态，垃圾收集器会删除对象的所有附属</li>
<li>垃圾收集器在删除了所有有阻塞能力的附属（对象的 ownerReference.blockOwnerDeletion=true） 之后，删除属主对象</li>
<li>只有设置了 ownerReference.blockOwnerDeletion 值的附属才能阻止删除属主对象</li>
<li>
<p>后台级联删除</p>
</li>
<li>
<p>Kubernetes 会立即删除属主对象，之后垃圾收集器 会在后台删除其附属对象</p>
</li>
<li>
<p>设置级联删除策略</p>
</li>
<li>
<p>通过为属主对象设置 deleteOptions.propagationPolicy 字段，可以控制级联删除策略</p>
</li>
<li>
<p>可能的取值包括：Orphan、Foreground 或者 Background</p>
</li>
<li>
<p>示例</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>下面是一个在后台删除附属对象的示例：

kubectl proxy --port<span class="o">=</span><span class="m">8080</span>
curl -X DELETE localhost:8080/apis/apps/v1/namespaces/default/replicasets/my-repset <span class="se">\</span>
  -d <span class="s1">&#39;{&quot;kind&quot;:&quot;DeleteOptions&quot;,&quot;apiVersion&quot;:&quot;v1&quot;,&quot;propagationPolicy&quot;:&quot;Background&quot;}&#39;</span> <span class="se">\</span>
  -H <span class="s2">&quot;Content-Type: application/json&quot;</span>

下面是一个在前台中删除附属对象的示例：

kubectl proxy --port<span class="o">=</span><span class="m">8080</span>
curl -X DELETE localhost:8080/apis/apps/v1/namespaces/default/replicasets/my-repset <span class="se">\</span>
  -d <span class="s1">&#39;{&quot;kind&quot;:&quot;DeleteOptions&quot;,&quot;apiVersion&quot;:&quot;v1&quot;,&quot;propagationPolicy&quot;:&quot;Foreground&quot;}&#39;</span> <span class="se">\</span>
  -H <span class="s2">&quot;Content-Type: application/json&quot;</span>

下面是一个令附属成为孤立对象的示例：

kubectl proxy --port<span class="o">=</span><span class="m">8080</span>
curl -X DELETE localhost:8080/apis/apps/v1/namespaces/default/replicasets/my-repset <span class="se">\</span>
  -d <span class="s1">&#39;{&quot;kind&quot;:&quot;DeleteOptions&quot;,&quot;apiVersion&quot;:&quot;v1&quot;,&quot;propagationPolicy&quot;:&quot;Orphan&quot;}&#39;</span> <span class="se">\</span>
  -H <span class="s2">&quot;Content-Type: application/json&quot;</span>
</code></pre></div>
<ul>
<li>kubectl 命令也支持级联删除</li>
<li>通过设置 --cascade 为 true，可以使用 kubectl 自动删除附属对象</li>
<li>设置 --cascade 为 false，会使附属对象成为孤立附属对象。 --cascade 的默认值是 true</li>
</ul>

              

<!-- Giscus -->
<h2 id="__comments">Comments</h2>

<script src="https://giscus.app/client.js" data-repo="lrtz-v/lrtz-v.github.io"
  data-repo-id="MDEwOlJlcG9zaXRvcnkzMDQyNzQ2MzE=" data-category="General" data-category-id="DIC_kwDOEiLcx84CQDFq"
  data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom"
  data-theme="dark" data-lang="zh-CN" crossorigin="anonymous" async>
  </script>

<!-- Synchronize Giscus theme with palette -->
<script>
  var giscus = document.querySelector("script[src*=giscus]")

  /* Set palette on initial load */
  var palette = __md_get("__palette")
  if (palette && typeof palette.color === "object") {
    var theme = palette.color.scheme === "slate" ? "dark" : "light"
    giscus.setAttribute("data-theme", theme)
  }

  /* Register event handlers after documented loaded */
  document.addEventListener("DOMContentLoaded", function () {
    var ref = document.querySelector("[data-md-component=palette]")
    ref.addEventListener("change", function () {
      var palette = __md_get("__palette")
      if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate" ? "dark" : "light"

        /* Instruct Giscus to change theme */
        var frame = document.querySelector(".giscus-frame")
        frame.contentWindow.postMessage(
          { giscus: { setConfig: { theme } } },
          "https://giscus.app"
        )
      }
    })
  })
</script>

            </article>
            
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../basic/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 基础" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              基础
            </div>
          </div>
        </a>
      
      
        
        <a href="../services/" class="md-footer__link md-footer__link--next" aria-label="Next: 网络及服务" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              网络及服务
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "navigation.instant", "navigation.tracking", "content.code.annotate", "content.tabs.link", "navigation.indexes", "navigation.tabs", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
        <script src="../../javascripts/extra.js"></script>
      
        <script src="../../javascripts/tablesort.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>